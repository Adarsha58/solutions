An output formatting problem, mostly. Just keep a dictionary of variable values, update when told, and output expressions when told. 
